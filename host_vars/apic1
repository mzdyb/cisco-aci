---
tenants:
  - tenant_name: production
    description: 'Production Tenant'
    tenant_state: present

vrfs:
  - vrf_name: vrf1
    description: 'Production VRF'
    tenant: production
    policy_direction: ingress
    policy_enforcement: enforced
    vrf_state: present

bridge_domains:
  - bd_name: app_bd
    tenant: production
    vrf: vrf1
    bd_state: present
    subnets:
      - gateway: 10.0.1.1
        mask: 24
        scope: public
  - bd_name: database_bd
    tenant: production
    vrf: vrf1
    subnets:
      - gateway: 10.0.2.1
        mask: 24
        scope: public

application_profiles:
  - ap_name: ap1
    tenant: production

epgs:
  - epg_name: app_epg
    tenant: production
    ap: ap1
    bd: app_bd
    # epg_contracts:
    #   - contract: app_to_database
    #     contract_type: consumer
  - epg_name: database_epg
    tenant: production
    ap: ap1
    bd: database_bd
    epg_contracts:
      - contract: app_to_database
        contract_type: provider

filters:
  - filter_name: db_filter
    tenant: production
    description: 'db filter'
    filter_entries:
      - entry_name: 'allow_mysql'
        ethertype: ip
        protocol: tcp
        dst_port: 3306
      
contracts:
  - contract_name: app_to_database
    tenant: production
    description: 'Communication between app server and database'
    scope: context
    subjects:
      - subject_name: allow_app_to_database
        filter: db_filter